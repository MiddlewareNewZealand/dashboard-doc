---
id: firestore-profile
title: Profile
sidebar_label: Profile
sidebar_position: 1
last_update:
    date: 2025/09/22
    author: Ijaan Yudana
---

# Profile

The profile collection represents user data synced across various sources. Currently,
data is coming from ipayroll and workflowmax.

This is an example of a user profile:

```
Hash: 123abc456def789 (str)
UpdatedAt: 1234567890 (num)
birthDate: "01-Jan-01" (str)
displayName: "John Doe" (str)
email: "John.Doe@domain.com" (str)
ipayrollId= "1234567890" (str)
mobile="1234567890" (str)
practice="documentation writer" (str)
startDate="01-Jan-01" (str)
title="documentation writer" (str)
workflowId="1234567890" (str)
practice="documentator" (str)
```

## Field sources

<div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '2rem' }}>
  <div>
    ### iPayroll

    - `ipayrollId`
    - `title`
    - `startDate`
    - `email`
    - `mobile` (renamed from 'phone')
    - `displayName` ((preferredName || firstnames[0]) + " " + lastname)
    - `birthDate`
  </div>
  
  <div>
    ### workflowMax

    - `workflowId`
    - `practice`
  </div>
</div>

## Sync Behaviour

### Overview

IPayroll is the source of truth. If a record is removed from ipayroll, it is removed from profiles. 
All other sources only append onto the ipayroll document. 

### IPayroll

If it detects a change in hash, it will loop over the new and changed ipayroll ids.

It will: 
- `Update` entries where an email matches and `create` new entries if there is no matching email.
- Calculate whether there are any Ids to `delete`, loop over them and `delete` them as a batch
- `Update` the hash field

### WorkflowMax

If the `full` flag is `true` (Occurs when) `workflowFullSyncStaffOnTopic` is called it will go over every `workflowStaffMember` and `update` their entry.

If there is data to add, it will loop over the entries and `update` existing records.

If there are workflow staff members to remove it will `delete` only the workflowmax associated fields.

Hash is `updated`

As you can see, workflowmax is wholly reliant on ipayroll to be able to insert information and can only manage its own data within that.

## Relevant Cloud Functions

<div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '2rem' }}>
  <div>
    ### iPayroll

    - `ipayrollStaffOnTopic` 
    - `ipayrollSyncStaffOnScheduleWeekdayFifteenMinute` 
    - `ipayrollSyncStaffOnScheduleWeekdayHour`
    - `ipayrollSyncStaffOnScheduleWeekendHour`
  </div>
  
  <div>
    ### workflowMax

    - `workflowSyncStaffOnTopic`
    - `workflowSyncStaffOnScheduleWeekdayFifteenMinute` 
    - `workflowSyncStaffOnScheduleWeekdayHour`
    - `workflowSyncStaffOnScheduleWeekendHour`
  </div>
</div>






